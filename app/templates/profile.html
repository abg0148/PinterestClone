{% extends "base_authenticated.html" %}

{% block title %}
    {% if user.id == current_user.id %}
        My Profile
    {% else %}
        {{ user.username }}'s Profile
    {% endif %}
{% endblock %}

{% block extra_styles %}
<style>
    .profile-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 24px;
    }

    .profile-header {
        display: flex;
        align-items: center;
        gap: 32px;
        margin-bottom: 48px;
    }

    .profile-picture {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        overflow: hidden;
    }

    .profile-picture img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .profile-info {
        flex: 1;
    }

    .profile-name {
        font-size: 36px;
        font-weight: 600;
        margin-bottom: 4px;
    }

    .profile-username {
        font-size: 18px;
        color: #666;
        margin-bottom: 24px;
    }

    .profile-bio {
        font-size: 16px;
        line-height: 1.5;
        margin-bottom: 24px;
        color: #333;
    }

    .profile-actions {
        display: flex;
        gap: 16px;
        margin-top: 16px;
    }

    .profile-button {
        padding: 8px 16px;
        border-radius: 24px;
        font-weight: 500;
        text-decoration: none;
        cursor: pointer;
        border: none;
    }

    .primary-button {
        background-color: #e60023;
        color: white;
    }

    .secondary-button {
        background-color: #efefef;
        color: #333;
    }

    .boards-section {
        margin-top: 48px;
    }

    .boards-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 24px;
        margin-top: 24px;
    }

    .board-card {
        background: white;
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .board-title {
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 16px;
        color: #333;
        text-decoration: none;
        display: block;
    }

    .board-title:hover {
        color: #e60023;
    }

    .board-description {
        color: #666;
        font-size: 14px;
        line-height: 1.5;
    }

    .board-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: #666;
    }
</style>
{% endblock %}

{% block content %}
<div class="profile-container">
    <div class="profile-header">
        <div class="profile-picture">
            <img src="{{ url_for('profile.profile_picture', user_id=user.id) }}" alt="Profile Picture">
        </div>
        
        <div class="profile-info">
            <h1 class="profile-name">{{ user.full_name or user.username }}</h1>
            {% if user.full_name %}
                <p class="profile-username">{{ user.username }}</p>
            {% endif %}
            <p class="profile-bio">{{ user.bio or 'No bio yet.' }}</p>
            
            <div class="profile-actions">
                {% if user.id == current_user.id %}
                    <a href="{{ url_for('profile.edit_profile') }}" class="profile-button secondary-button">Edit Profile</a>
                {% else %}
                    <div class="friend-actions">
                        {% if friendship_status == 'not_friends' %}
                            <form method="POST" action="{{ url_for('friends.add_friend') }}" style="display: inline;">
                                <input type="hidden" name="target_id" value="{{ user.id }}">
                                <button type="submit" class="profile-button primary-button">Add Friend</button>
                            </form>
                        {% elif friendship_status == 'pending_sent' %}
                            <button class="profile-button secondary-button" disabled>Friend Request Sent</button>
                        {% elif friendship_status == 'pending_received' %}
                            <form method="POST" action="{{ url_for('friends.friend_request_response') }}" style="display: inline;">
                                <input type="hidden" name="from_id" value="{{ user.id }}">
                                <input type="hidden" name="to_id" value="{{ current_user.id }}">
                                <input type="hidden" name="response" value="accepted">
                                <button type="submit" class="profile-button primary-button">Accept Friend Request</button>
                            </form>
                            <form method="POST" action="{{ url_for('friends.friend_request_response') }}" style="display: inline;">
                                <input type="hidden" name="from_id" value="{{ user.id }}">
                                <input type="hidden" name="to_id" value="{{ current_user.id }}">
                                <input type="hidden" name="response" value="declined">
                                <button type="submit" class="profile-button secondary-button">Reject</button>
                            </form>
                        {% elif friendship_status == 'friends' %}
                            <button class="profile-button secondary-button" disabled>Friends</button>
                        {% endif %}
                    </div>
                {% endif %}
                
                <a href="{{ url_for('profile.view_friends', user_id=user.id) }}" class="profile-button secondary-button">
                    {% if user.id == current_user.id %}
                        My Friends
                    {% else %}
                        {{ user.username }}'s Friends
                    {% endif %}
                </a>
            </div>
        </div>
    </div>

    <div class="boards-section">
        <h2>
            {% if user.id == current_user.id %}
                My Boards
            {% else %}
                {{ user.username }}'s Boards
            {% endif %}
        </h2>

        {% if boards %}
            <div class="boards-grid">
                {% for board in boards %}
                    <div class="board-card">
                        <a href="{{ url_for('boards.view_board', board_id=board.id) }}" class="board-title">
                            {{ board.board_name }}
                        </a>
                        {% if board.description %}
                            <p class="board-description">{{ board.description }}</p>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p>No boards created yet.</p>
        {% endif %}
    </div>
</div>
{% endblock %}
