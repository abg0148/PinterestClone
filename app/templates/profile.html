{% extends "base_authenticated.html" %}
{% from "components/board_tile.html" import board_tile, board_tile_styles %}

{% block title %}
    {% if user.id == current_user.id %}
        My Profile
    {% else %}
        {{ user.username }}'s Profile
    {% endif %}
{% endblock %}

{% block extra_styles %}
<style>
    .profile-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 24px;
    }

    .profile-header {
        display: flex;
        align-items: center;
        gap: 32px;
        margin-bottom: 48px;
    }

    .profile-picture {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        overflow: hidden;
    }

    .profile-picture img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .profile-info {
        flex: 1;
    }

    .profile-name {
        font-size: 36px;
        font-weight: 600;
        margin-bottom: 4px;
    }

    .profile-username {
        font-size: 18px;
        color: var(--text-secondary);
        margin-bottom: 24px;
    }

    .profile-bio {
        font-size: 16px;
        line-height: 1.5;
        margin-bottom: 24px;
        color: var(--text-primary);
    }

    .profile-stats {
        display: flex;
        gap: 24px;
        margin-bottom: 24px;
    }

    .stat-item {
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--text-primary);
        text-decoration: none;
    }

    .stat-count {
        font-weight: 600;
    }

    .profile-actions {
        display: flex;
        gap: 16px;
        margin-top: 16px;
    }

    .profile-button {
        padding: 8px 16px;
        border-radius: 24px;
        font-weight: 500;
        text-decoration: none;
        cursor: pointer;
        border: none;
        transition: all 0.2s ease;
    }

    .profile-button:hover {
        transform: translateY(-1px);
    }

    .primary-button {
        background-color: var(--primary-color);
        color: white;
    }

    .primary-button:hover {
        background-color: var(--primary-hover);
    }

    .secondary-button {
        background-color: #efefef;
        color: var(--text-primary);
    }

    .secondary-button:hover {
        background-color: #e0e0e0;
    }

    .boards-section {
        margin-top: 48px;
    }

    .boards-section h2 {
        font-size: 24px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 24px;
    }

    .friend-status {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        border-radius: 24px;
        font-size: 14px;
        font-weight: 500;
    }

    .friend-status.pending {
        background-color: #ffd700;
        color: #000;
    }

    .friend-status.friends {
        background-color: #4caf50;
        color: white;
    }
</style>
{{ board_tile_styles() }}
{% endblock %}

{% block content %}
<div class="profile-container">
    <div class="profile-header">
        <div class="profile-picture">
            <img src="{{ url_for('profile.profile_picture', user_id=user.id) }}" alt="{{ user.username }}'s picture">
        </div>
        <div class="profile-info">
            <h1 class="profile-name">{{ user.full_name or user.username }}</h1>
            <p class="profile-username">@{{ user.username }}</p>
            {% if user.bio %}
                <p class="profile-bio">{{ user.bio }}</p>
            {% endif %}

            <div class="profile-stats">
                <a href="{{ url_for('profile.view_friends', user_id=user.id) }}" class="stat-item">
                    <span class="stat-count">{{ friends|length }}</span>
                    <span class="stat-label">Friends</span>
                </a>
                <div class="stat-item">
                    <span class="stat-count">{{ boards|length }}</span>
                    <span class="stat-label">Boards</span>
                </div>
            </div>

            <div class="profile-actions">
                {% if user.id == current_user.id %}
                    <a href="{{ url_for('profile.edit_profile') }}" class="profile-button secondary-button">Edit Profile</a>
                {% else %}
                    {% if friendship_status == 'friends' %}
                        <span class="friend-status friends">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 6L9 17l-5-5"/>
                            </svg>
                            Friends
                        </span>
                    {% elif friendship_status == 'pending_sent' %}
                        <span class="friend-status pending">Request Sent</span>
                    {% elif friendship_status == 'pending_received' %}
                        <form method="POST" action="{{ url_for('social.accept_friend_request', user_id=user.id) }}" style="display: inline;">
                            <button type="submit" class="profile-button primary-button">Accept Friend Request</button>
                        </form>
                        <form method="POST" action="{{ url_for('social.decline_friend_request', user_id=user.id) }}" style="display: inline;">
                            <button type="submit" class="profile-button secondary-button">Decline</button>
                        </form>
                    {% else %}
                        <form method="POST" action="{{ url_for('social.send_friend_request', user_id=user.id) }}" style="display: inline;">
                            <button type="submit" class="profile-button primary-button">Add Friend</button>
                        </form>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </div>

    <div class="boards-section">
        <h2>
            {% if user.id == current_user.id %}
                My Boards
            {% else %}
                {{ user.username }}'s Boards
            {% endif %}
        </h2>

        {% if boards %}
            <div class="boards-grid">
                {% for board in boards %}
                    {{ board_tile(board) }}
                {% endfor %}
            </div>
        {% else %}
            <p>No boards created yet.</p>
        {% endif %}
    </div>
</div>
{% endblock %}
